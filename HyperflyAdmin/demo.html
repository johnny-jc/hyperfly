<link rel="stylesheet" href="../../common/plugins/jquery-pagination/pagination.css">

<div id="pjax-content">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">角色管理</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="javascript:void(0)">首页</a></li>
                        <li class="breadcrumb-item active">角色管理</li>
                    </ol>
                </div>
            </div>
        </div>
        <!-- container-fluid -->

        <!-- content-header -->
        <div class="content">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-sm-9">
                                    <div class="form-inline">
                                        <div class="form-group mx-sm-3 mb-2">
                                            <input type="text" id="search-role-name" class="form-control"
                                                   placeholder="名称">
                                        </div>
                                        <button id="search-btn" class="btn btn-primary mb-2">搜索</button>
                                        <button id="reset-search-btn" class="btn btn-primary mb-2 mx-sm-2">重置
                                        </button>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <button type="button" id="create-role" class="btn btn-primary btn-sm float-right">
                                        添加角色
                                    </button>
                                    <button type="button" id="refresh-table-data"
                                            class="btn btn-primary btn-sm float-right mx-sm-2">
                                        <span class="fa fa-sync-alt"></span>
                                        刷新
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="dataTables_wrapper dt-bootstrap4"></div>
                            <div class="row">
                                <div class="col-12">
                                    <table class="table table-bordered table-hover dataTable dtr-inline" role="grid">
                                        <thead>
                                        <tr role="row">
                                            <th class="sorting sorting_asc">ID</th>
                                            <th class="sorting sorting_asc">名称</th>
                                            <th class="sorting sorting_asc">添加时间</th>
                                            <th class="sorting sorting_asc">状态</th>
                                            <th class="sorting sorting_asc">更新时间</th>
                                            <th class="sorting sorting_asc">操作</th>
                                        </tr>
                                        </thead>
                                        <tbody id="table-data">
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-5">
                                    <div class="dataTables_info" id="example2_info" role="status" aria-live="polite">
                                        总共&nbsp;<b><span id="total-count">/</span></b>&nbsp;条&nbsp;<b><span
                                            id="total-page">/
                                    </span></b>
                                        &nbsp;页数据，当前显示第<b>&nbsp;<span id="total-cur-page">/</span> &nbsp;</b>页数据
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-7">
                                    <div class="dataTables_paginate float-right">
                                        <div id="pagination"></div>
                                    </div>
                                    <!-- pagination end -->
                                    <!-- pagination end -->
                                </div>
                            </div>
                            <!-- row end -->
                        </div>
                        <!--card body end -->
                    </div>
                    <!-- card end -->
                </div>
            </div>
        </div>
    </div>
    <!-- content -->
    <script type="text/javascript" src="../../common/js/common.js"></script>
    <script type="text/javascript" src="../../common/plugins/jquery-pagination/pagination.js"></script>
    <script type="text/javascript" src="../../common/js/common.js"></script>
    <script type="text/javascript">
        jq(document).ready(function () {

            //获取分页 start
            var tableDataPagination = function () {
                var url = commonUrl + 'admin/v1/role/getRoleList'
                jq('#pagination').pagination({
                    pageRange: 2,
                    className: 'paginationjs-theme-blue paginationjs-big',
                    pageSize: 20,
                    showFirstOnEllipsisShow: true,
                    showLastOnEllipsisShow: true,
                    callback: function (data, pagination) {
                        var count = pagination.totalNumber
                        var pageNumber = pagination.pageNumber
                        var pageSize = pagination.pageSize
                        var offset = (pageNumber - 1) * pageSize
                        var limit = pageSize

                        //设置统计数据 start
                        jq('#total-count').text(count)
                        jq('#total-page').text(Math.ceil(count / pageSize))
                        jq('#total-cur-page').text(pageNumber)
                        //设置统计数据 end

                        var name = jq('#search-role-name').val()
                        var data = {}
                        data.name = name
                        data.offset = offset
                        data.limit = limit

                        openLoad()
                        ajaxPost(url, data, function (response) {
                            closeLoad()
                            if (isResponseFail(getResponseCode(response))) {
                                layerFail(getResponseMessage(response))
                            }
                            if (isResponseSuccess(getResponseCode(response))) {
                                var data = getResponseData(response)
                                var listHtml = ''
                                var listDataObj = data.list
                                var listDataObjLen = Object.keys(listDataObj).length
                                for (var i = 0; i < listDataObjLen; i++) {
                                }
                                jq('#table-data').html(listHtml)
                            }
                        })
                    },

                    dataSource: function (done) {
                        var name = jq('#search-role-name').val()
                        var data = {}
                        data.name = name
                        openLoad()
                        ajaxPost(url, data, function (response) {
                            closeLoad()
                            var listArr = []
                            if (isResponseFail(getResponseCode(response))) {
                                layerFail(getResponseMessage(response))
                            }
                            if (isResponseSuccess(getResponseCode(response))) {
                                var data = getResponseData(response)
                                for (var i = 0; i < data.count; i++) {
                                    listArr.push(i)
                                }
                                done(listArr)
                            }
                        })
                    },
                })
            }
            tableDataPagination()
            //获取分页 end
        })
    </script>
</div>
